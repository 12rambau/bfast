-- import "stl"
import "stl_rewrite"

let main =
  let arr = [[315.42f32, 316.31f32, 316.5f32, 317.56f32, 318.13f32, 318.0f32, 316.39f32,
  314.65f32, 313.68f32, 313.18f32, 314.66f32, 315.43f32, 316.27f32, 316.81f32,
  317.42f32, 318.87f32, 319.87f32, 319.43f32, 318.01f32, 315.74f32, 314.0f32,
  313.68f32, 314.84f32, 316.03f32, 316.73f32, 317.54f32, 318.38f32, 319.31f32,
  320.42f32, 319.61f32, 318.42f32, 316.63f32, 314.83f32, 315.16f32, 315.94f32,
  316.85f32, 317.78f32, 318.4f32, 319.53f32, 320.42f32, 320.85f32, 320.45f32,
  319.45f32, 317.25f32, 316.11f32, 315.27f32, 316.53f32, 317.53f32, 318.58f32,
  318.92f32, 319.7f32, 321.22f32, 322.08f32, 321.31f32, 319.58f32, 317.61f32,
  316.05f32, 315.83f32, 316.91f32, 318.2f32, 319.41f32, 320.07f32, 320.74f32,
  321.4f32, 322.06f32, 321.73f32, 320.27f32, 318.54f32, 316.54f32, 316.71f32,
  317.53f32, 318.55f32, 319.27f32, 320.28f32, 320.73f32, 321.97f32, 322.0f32,
  321.71f32, 321.05f32, 318.71f32, 317.66f32, 317.14f32, 318.7f32, 319.25f32,
  320.46f32, 321.43f32, 322.23f32, 323.54f32, 323.91f32, 323.59f32, 322.24f32,
  320.2f32, 318.48f32, 317.94f32, 319.63f32, 320.87f32, 322.17f32, 322.34f32,
  322.88f32, 324.25f32, 324.83f32, 323.93f32, 322.38f32, 320.76f32, 319.1f32,
  319.24f32, 320.56f32, 321.8f32, 322.4f32, 322.99f32, 323.73f32, 324.86f32,
  325.4f32, 325.2f32, 323.98f32, 321.95f32, 320.18f32, 320.09f32, 321.16f32,
  322.74f32, 323.83f32, 324.26f32, 325.47f32, 326.5f32, 327.21f32, 326.54f32,
  325.72f32, 323.5f32, 322.22f32, 321.62f32, 322.69f32, 323.95f32, 324.89f32,
  325.82f32, 326.77f32, 327.97f32, 327.91f32, 327.5f32, 326.18f32, 324.53f32,
  322.93f32, 322.9f32, 323.85f32, 324.96f32, 326.01f32, 326.51f32, 327.01f32,
  327.62f32, 328.76f32, 328.4f32, 327.2f32, 325.27f32, 323.2f32, 323.4f32,
  324.63f32, 325.85f32, 326.6f32, 327.47f32, 327.58f32, 329.56f32, 329.9f32,
  328.92f32, 327.88f32, 326.16f32, 324.68f32, 325.04f32, 326.34f32, 327.39f32,
  328.37f32, 329.4f32, 330.14f32, 331.33f32, 332.31f32, 331.9f32, 330.7f32,
  329.15f32, 327.35f32, 327.02f32, 327.99f32, 328.48f32, 329.18f32, 330.55f32,
  331.32f32, 332.48f32, 332.92f32, 332.08f32, 331.01f32, 329.23f32, 327.27f32,
  327.21f32, 328.29f32, 329.41f32, 330.23f32, 331.25f32, 331.87f32, 333.14f32,
  333.8f32, 333.43f32, 331.73f32, 329.9f32, 328.4f32, 328.17f32, 329.32f32,
  330.59f32, 331.58f32, 332.39f32, 333.33f32, 334.41f32, 334.71f32, 334.17f32,
  332.89f32, 330.77f32, 329.14f32, 328.78f32, 330.14f32, 331.52f32, 332.75f32,
  333.24f32, 334.53f32, 335.9f32, 336.57f32, 336.1f32, 334.76f32, 332.59f32,
  331.42f32, 330.98f32, 332.24f32, 333.68f32, 334.8f32, 335.22f32, 336.47f32,
  337.59f32, 337.84f32, 337.72f32, 336.37f32, 334.51f32, 332.6f32, 332.38f32,
  333.75f32, 334.78f32, 336.05f32, 336.59f32, 337.79f32, 338.71f32, 339.3f32,
  339.12f32, 337.56f32, 335.92f32, 333.75f32, 333.7f32, 335.12f32, 336.56f32,
  337.84f32, 338.19f32, 339.91f32, 340.6f32, 341.29f32, 341.0f32, 339.39f32,
  337.43f32, 335.72f32, 335.84f32, 336.93f32, 338.04f32, 339.06f32, 340.3f32,
  341.21f32, 342.33f32, 342.74f32, 342.08f32, 340.32f32, 338.26f32, 336.52f32,
  336.68f32, 338.19f32, 339.44f32, 340.57f32, 341.44f32, 342.53f32, 343.39f32,
  343.96f32, 343.18f32, 341.88f32, 339.65f32, 337.81f32, 337.69f32, 339.09f32,
  340.32f32, 341.2f32, 342.35f32, 342.93f32, 344.77f32, 345.58f32, 345.14f32,
  343.81f32, 342.21f32, 339.69f32, 339.82f32, 340.98f32, 342.82f32, 343.52f32,
  344.33f32, 345.11f32, 346.88f32, 347.25f32, 346.62f32, 345.22f32, 343.11f32,
  340.9f32, 341.18f32, 342.8f32, 344.04f32, 344.79f32, 345.82f32, 347.25f32,
  348.17f32, 348.74f32, 348.07f32, 346.38f32, 344.51f32, 342.92f32, 342.62f32,
  344.06f32, 345.38f32, 346.11f32, 346.78f32, 347.68f32, 349.37f32, 350.03f32,
  349.37f32, 347.76f32, 345.73f32, 344.68f32, 343.99f32, 345.48f32, 346.72f32,
  347.84f32, 348.29f32, 349.23f32, 350.8f32, 351.66f32, 351.07f32, 349.33f32,
  347.92f32, 346.27f32, 346.18f32, 347.64f32, 348.78f32, 350.25f32, 351.54f32,
  352.05f32, 353.41f32, 354.04f32, 353.62f32, 352.22f32, 350.27f32, 348.55f32,
  348.72f32, 349.91f32, 351.18f32, 352.6f32, 352.92f32, 353.53f32, 355.26f32,
  355.52f32, 354.97f32, 353.75f32, 351.52f32, 349.64f32, 349.83f32, 351.14f32,
  352.37f32, 353.5f32, 354.55f32, 355.23f32, 356.04f32, 357.0f32, 356.07f32,
  354.67f32, 352.76f32, 350.82f32, 351.04f32, 352.69f32, 354.07f32, 354.59f32,
  355.63f32, 357.03f32, 358.48f32, 359.22f32, 358.12f32, 356.06f32, 353.92f32,
  352.05f32, 352.11f32, 353.64f32, 354.89f32, 355.88f32, 356.63f32, 357.72f32,
  359.07f32, 359.58f32, 359.17f32, 356.94f32, 354.92f32, 352.94f32, 353.23f32,
  354.09f32, 355.33f32, 356.63f32, 357.1f32, 358.32f32, 359.41f32, 360.23f32,
  359.55f32, 357.53f32, 355.48f32, 353.67f32, 353.95f32, 355.3f32, 356.78f32,
  358.34f32, 358.89f32, 359.95f32, 361.25f32, 361.67f32, 360.94f32, 359.55f32,
  357.49f32, 355.84f32, 356.0f32, 357.59f32, 359.05f32, 359.98f32, 361.03f32,
  361.66f32, 363.48f32, 363.82f32, 363.3f32, 361.94f32, 359.5f32, 358.11f32,
  357.8f32, 359.61f32, 360.74f32, 362.09f32, 363.29f32, 364.06f32, 364.76f32,
  365.45f32, 365.01f32, 363.7f32, 361.54f32, 359.51f32, 359.65f32, 360.8f32,
  362.38f32, 363.23f32, 364.06f32, 364.61f32, 366.4f32, 366.84f32, 365.68f32,
  364.52f32, 362.57f32, 360.24f32, 360.83f32, 362.49f32, 364.34f32]]

  -- add nans
  let arr =
    arr with [0, 10] = f32.nan

  let arr =
    arr with [0, 20] = f32.nan

  let arr =
    arr with [0, 30] = f32.nan

  let arr =
    arr with [0, 40] = f32.nan

  -- let (a, b, _) = (map (\i -> stl i 12) arr |> unzip3)
  -- let _ = a[0, 9:31] |> trace
  -- let _ = b[0, 9:31] |> trace
  -- in a
  let (a, b, _) = stl arr 12
  let _ = a[0, 9:31] |> trace
  let _ = b[0, 9:31] |> trace
  in a
